(this.webpackJsonpmugctl=this.webpackJsonpmugctl||[]).push([[0],{164:function(e,t,r){},278:function(e,t,r){},280:function(e,t,r){"use strict";r.r(t);var a=r(0),c=r.n(a),i=r(33),n=r.n(i),s=(r(164),r(124)),o=r(76),l=r(102),h=r(103),d=r(106),u=r(104),g=r(45),b=r(105),j=r(27),m=r(50),f=r(127),x=r(126),p=r(129),C=r(128),w=r(111);var O;!function(e){e.descriptorService="0000180a-0000-1000-8000-00805f9b34fb",e.emberService="fc543622-236c-4c94-8fa9-944a3e5353fa",e.mugNameChar="fc540001-236c-4c94-8fa9-944a3e5353fa",e.drinkTempChar="fc540002-236c-4c94-8fa9-944a3e5353fa",e.targetTempChar="fc540003-236c-4c94-8fa9-944a3e5353fa",e.liquidLevelChar="fc540005-236c-4c94-8fa9-944a3e5353fa",e.batteryChar="fc540007-236c-4c94-8fa9-944a3e5353fa",e.liquidStateChar="fc540008-236c-4c94-8fa9-944a3e5353fa",e.ledColorChar="fc540014-236c-4c94-8fa9-944a3e5353fa",e.pushEventChar="fc540012-236c-4c94-8fa9-944a3e5353fa",e.statisticsChar="fc540013-236c-4c94-8fa9-944a3e5353fa"}(O||(O={}));const y=e=>e.getUint16(0,!0)/100;var v;let _,T;!function(e){e[e.battery=1]="battery",e[e.chargerConnected=2]="chargerConnected",e[e.chargerDisconnected=3]="chargerDisconnected",e[e.targetTemperature=4]="targetTemperature",e[e.drinkTemperature=5]="drinkTemperature",e[e.liquidLevel=7]="liquidLevel",e[e.liquidState=8]="liquidState"}(v||(v={})),function(e){e[e.off=0]="off",e[e.empty=1]="empty",e[e.cold=3]="cold",e[e.tooLow=5]="tooLow",e[e.atTemperature=6]="atTemperature",e[e.unknown7=7]="unknown7"}(_||(_={})),function(e){e[e.idle=0]="idle",e[e.choosing=1]="choosing",e[e.connecting=2]="connecting",e[e.ready=3]="ready"}(T||(T={}));class S{constructor(e){this._queue=void 0,this._setters=void 0,this._device=void 0,this._chars=void 0,this._setters=e,this._device=null,this._chars={},this._queue=w.a.queue(S._worker,1)}connected(){return 0!==Object.keys(this._chars).length}async connect(){var e;if(console.info("Connecting"),this._setters.setConnState(T.choosing),this._device=await navigator.bluetooth.requestDevice({filters:[{name:"Ember Ceramic Mug",services:[O.descriptorService]}],optionalServices:[O.emberService]}),!this._device)throw new Error("Cevice selection cancelled");this._setters.setConnState(T.connecting),this._device.addEventListener("gattserverdisconnected",(e=>{console.debug("GATT server disconnected"),this._chars={},this._setters.setConnState(T.idle)}));const t=await(null===(e=this._device.gatt)||void 0===e?void 0:e.connect());if(!t)throw new Error("Cannot connect");const r=await(null===t||void 0===t?void 0:t.getPrimaryService(O.emberService));if(!r)throw new Error("Cannot get primary service");for(const a of[O.mugNameChar,O.drinkTempChar,O.targetTempChar,O.liquidLevelChar,O.batteryChar,O.liquidStateChar,O.ledColorChar]){const e=await r.getCharacteristic(a);if(!e)throw new Error(`Cannot get characteristic ${a}`);this._chars[a]=e}for(const a of[O.pushEventChar,O.statisticsChar]){const e=await r.getCharacteristic(a);if(!e)throw new Error(`Cannot get characteristic ${a}`);await e.startNotifications(),e.addEventListener("characteristicvaluechanged",(e=>S._charChanged(this,e))),this._chars[a]=e}this._setters.setConnState(T.ready)}getMugName(){this._queue.push({that:this,cmd:"getMugName"})}setMugName(e){this._queue.push({that:this,cmd:"setMugName",args:[e]})}getDrinkTemperature(){this._queue.push({that:this,cmd:"getDrinkTemperature"})}getTargetTemperature(){this._queue.push({that:this,cmd:"getTargetTemperature"})}setTargetTemperature(e){this._queue.push({that:this,cmd:"setTargetTemperature",args:[e]})}getBattery(){this._queue.push({that:this,cmd:"getBattery"})}getLiquidLevel(){this._queue.push({that:this,cmd:"getLiquidLevel"})}getLiquidState(){this._queue.push({that:this,cmd:"getLiquidState"})}getLedColor(){this._queue.push({that:this,cmd:"getLedColor"})}setLedColor(e){this._queue.push({that:this,cmd:"setLedColor",args:[e]})}async _setMugName(e){const t=(new TextEncoder).encode(e);await this._chars[O.mugNameChar].writeValueWithoutResponse(t),this.getMugName()}async _setTargetTemperature(e){e<50&&(e=50),e>65.5&&(e=65.5);const t=new DataView(new ArrayBuffer(2));t.setUint16(0,100*e,!0),await this._chars[O.targetTempChar].writeValueWithoutResponse(t),this.getTargetTemperature()}async _setLedColor(e){const t=new DataView(new ArrayBuffer(4));t.setUint8(0,e.r),t.setUint8(1,e.g),t.setUint8(2,e.b),t.setUint8(3,e.a),await this._chars[O.ledColorChar].writeValueWithoutResponse(t),this.getLedColor()}static async _worker({that:e,cmd:t,args:r}){var a;if(e.connected())switch(t){case"getMugName":e._setters.setMugName((a=await e._chars[O.mugNameChar].readValue(),(new TextDecoder).decode(a.buffer)));break;case"setMugName":const[t]=r;await e._setMugName(t);break;case"getDrinkTemperature":e._setters.setDrinkTemperature(y(await e._chars[O.drinkTempChar].readValue()));break;case"getTargetTemperature":e._setters.setTargetTemperature(y(await e._chars[O.targetTempChar].readValue()));break;case"setTargetTemperature":const[c]=r;await e._setTargetTemperature(c);break;case"getLiquidLevel":e._setters.setLiquidLevel((e=>e.getUint8(0)/100)(await e._chars[O.liquidLevelChar].readValue()));break;case"getBattery":e._setters.setBattery((e=>({level:e.getUint8(0)/100,charging:1===e.getUint8(1)}))(await e._chars[O.batteryChar].readValue()));break;case"getLiquidState":e._setters.setLiquidState((e=>e.getUint8(0))(await e._chars[O.liquidStateChar].readValue()));break;case"getLedColor":e._setters.setLedColor((e=>({r:e.getUint8(0),g:e.getUint8(1),b:e.getUint8(2),a:e.getUint8(3)}))(await e._chars[O.ledColorChar].readValue()));break;case"setLedColor":const[i]=r;await e._setLedColor(i)}else console.error("not connected")}static async _charChanged(e,t){const r=t.target,a=r.value;switch(r.uuid){case O.pushEventChar:let t=a.getUint8(0);switch(console.debug(`Characteristic ${v[t]} changed`),t){case v.battery:await e.getBattery();break;case v.chargerConnected:e._setters.setBattery((e=>({...e,charging:!0})));break;case v.chargerDisconnected:e._setters.setBattery((e=>({...e,charging:!1})));break;case v.targetTemperature:await e.getTargetTemperature();break;case v.drinkTemperature:await e.getDrinkTemperature();break;case v.liquidLevel:await e.getLiquidLevel();break;case v.liquidState:await e.getLiquidState()}break;case O.statisticsChar:console.debug("Got statistics:",a.byteLength,a.buffer)}}}var L=r(112),q=r(113),k=r(114),M=r(115),B=r(116),N=r(117),E=r(118),$=r(119),D=r(120),U=r(121),V=r(122),W=r(123),A=r(5);function F({battery:{level:e,charging:t},...r}){const a={0:[L.MdBattery20,q.MdBattery50,k.MdBattery60,M.MdBattery80,B.MdBattery90,N.MdBatteryFull],1:[E.MdBatteryCharging20,$.MdBatteryCharging50,D.MdBatteryCharging60,U.MdBatteryCharging80,V.MdBatteryCharging90,W.MdBatteryChargingFull]}[t?1:0][e<=.2?0:e<=.5?1:e<=.6?2:e<=.8?3:e<=.9?4:5];return Object(A.jsx)(j.a,{as:a,...e<.2?{color:"orange.600"}:{},...r})}var I=r.p+"static/media/mug.07a824a1.png";r(278);const R=({label:e,labelRight:t,children:r})=>Object(A.jsxs)(l.c,{p:4,borderRadius:12,borderColor:"gray.400",borderWidth:1,direction:"column",css:{gap:".6rem"},children:[Object(A.jsxs)(l.c,{direction:"row",justifyContent:"space-between",children:[Object(A.jsx)(l.e,{textColor:"gray.600",textAlign:"left",fontWeight:"light",children:e}),null!==t&&t]}),r]}),z=({color:e,onChange:t})=>{const r="#bbbbbb",a={...e,a:1},[i,n]=c.a.useState(a);Object(s.a)((()=>t({...i,a:255})),500,[i]);const h=255===i.r&&255===i.g&&255===i.b;return Object(A.jsxs)(l.c,{direction:"row",alignItems:"center",css:{gap:"1rem"},children:[Object(A.jsx)(o.b,{width:"100%",color:i,onChange:e=>n(e.rgb),className:h?"no-value":""}),Object(A.jsx)(o.a,{width:"",color:h?r:void 0,colors:[r],onChangeComplete:function(){n({r:255,g:255,b:255,a:1})}})]})},G=({temperature:e,onChange:t})=>{const[r,a]=c.a.useState(e);return Object(A.jsx)(R,{label:"Target temperature",labelRight:Object(A.jsx)(l.e,{textColor:"gray.600",textAlign:"right",fontWeight:"semibold",children:`${r}\xb0C`}),children:Object(A.jsxs)(l.c,{direction:"row",css:{gap:"1rem"},justifyContent:"center",children:[Object(A.jsx)(l.e,{fontWeight:"light",textColor:"gray.400",children:"50.0"}),Object(A.jsxs)(h.a,{"aria-label":"slider-ex-4",defaultValue:50,min:50,max:65.5,step:.5,flex:1,value:r,onChange:a,onChangeEnd:()=>t(r),children:[Object(A.jsx)(h.d,{bg:"gray.300",children:Object(A.jsx)(h.b,{bg:"brand.900"})}),Object(A.jsx)(h.c,{boxSize:6,children:Object(A.jsx)(l.a,{color:"brand.900",as:x.FaThermometerHalf})})]}),Object(A.jsx)(l.e,{fontWeight:"light",textColor:"gray.400",children:"65.5"})]})})};function H({onClick:e,error:t}){const[r,a]=c.a.useState(null!=t);return Object(A.jsxs)(l.c,{direction:"column",justifyContent:"space-evenly",flex:1,children:[Object(A.jsxs)(d.a,{isOpen:r,onClose:()=>a(!1),closeOnBlur:!1,placement:"bottom",children:[Object(A.jsx)(d.e,{children:Object(A.jsx)(u.a,{variant:"outline",onClick:e,leftIcon:Object(A.jsx)(f.GrConnect,{}),size:"lg",children:Object(A.jsx)(l.e,{children:"Connect"})})}),Object(A.jsxs)(d.c,{children:[Object(A.jsx)(d.d,{fontWeight:"semibold",children:"Error"}),Object(A.jsx)(d.b,{children:Object(A.jsx)(l.e,{children:t})})]})]}),Object(A.jsx)(l.e,{alignSelf:"flex-end",textColor:"gray.400",children:"Don't forget to power-on the mug using its button. If the list of devices remains empty, put the mug in pairing mode by holding its button for a few seconds. The light will flash blue and the mug should appear in the device list."})]})}function J({children:e}){return Object(A.jsxs)(l.c,{direction:"row",alignSelf:"center",alignItems:"center",justifyContent:"center",children:[Object(A.jsx)(g.a,{mx:2}),e]})}function P({battery:e}){return Object(A.jsx)(l.c,{direction:"row",alignSelf:"center",alignItems:"center",justifyContent:"space-between",children:Object(A.jsxs)(l.c,{direction:"row",css:{gap:".2rem"},alignItems:"center",children:[Object(A.jsx)(F,{battery:e}),Object(A.jsxs)(l.e,{children:[(100*e.level).toFixed(0),"%",Object(A.jsxs)(l.e,{as:"span",textColor:"gray.400",fontSize:"sm",children:[" ",e.charging?"charging":"discharging"]})]})]})})}const K=({temperature:e,name:t,battery:r,ledColor:a,onNameChange:i,liquidLevel:n})=>{const s=c.a.useRef(null);return c.a.useEffect((()=>{if(!s.current||!a)return;const e=a.r,t=a.g,r=a.b;s.current.animate([{boxShadow:`inset 0 0 90px rgba(${e},${t},${r},1.0), 0 0 4px 4px rgba(${e},${t},${r},0.4)`},{boxShadow:`inset 0 0 90px rgba(${e},${t},${r},1.0), 0 0 7px 7px rgba(${e},${t},${r},0.6)`}],{duration:1500,easing:"ease",direction:"alternate",iterations:1/0})}),[s,a]),Object(A.jsxs)(l.c,{direction:"row",w:"100%",children:[Object(A.jsxs)(l.a,{position:"relative",alignSelf:"center",children:[Object(A.jsx)(b.a,{src:I,objectFit:"contain",maxW:"19vh"}),Object(A.jsx)(l.e,{as:"span",textColor:"white",fontSize:"sm",position:"absolute",textAlign:"center",left:"0",right:"calc(19vh*0.22)",bottom:`calc(34px + ${n} * (19vh * 0.57))`,children:0===n?"Empty":`${(100*n).toFixed(0)}% full`}),Object(A.jsx)("div",{ref:s,style:{position:"absolute",width:"40px",height:"40px",bottom:"-6px",right:"calc(19vh * 0.33 + 40px/2)",borderRadius:"50%",transform:"scale(.8, .12)"}})]}),Object(A.jsxs)(l.c,{direction:"column",flex:1,alignItems:"center",children:[Object(A.jsxs)(l.c,{direction:"row",alignItems:"center",children:[Object(A.jsx)(l.d,{fontSize:"lg",fontWeight:"semibold",children:t}),Object(A.jsx)(u.b,{variant:"ghost","aria-label":"Rename",icon:Object(A.jsx)(C.AiFillEdit,{}),onClick:i,px:4})]}),Object(A.jsxs)(l.e,{fontSize:"5xl",children:[e.toFixed(1),"\xb0C"]}),Object(A.jsx)(P,{battery:r})]})]})};function Q(){const[e,t]=c.a.useState(null),[r,a]=c.a.useState(null),[i,n]=c.a.useState(null),[s,o]=c.a.useState(null),[h,d]=c.a.useState(null),[u,g]=c.a.useState(null),[b,j]=c.a.useState(null),[m,f]=c.a.useState(T.idle),[x]=c.a.useState(new S({setMugName:t,setConnState:f,setDrinkTemperature:a,setTargetTemperature:n,setLiquidLevel:o,setLiquidState:d,setBattery:g,setLedColor:j})),[p,C]=c.a.useState(null);c.a.useEffect((()=>{x.connected()&&m===T.ready&&(async()=>{x.getMugName(),x.getDrinkTemperature(),x.getBattery(),x.getTargetTemperature(),x.getLiquidLevel(),x.getLedColor(),x.getLiquidState()})()}),[x,m]);const w=[e,r,u,i,s,b,h].reduce(((e,t)=>e&&null!==t),!0);return Object(A.jsx)(A.Fragment,{children:m===T.idle&&Object(A.jsx)(H,{onClick:async function(){C(null);try{await x.connect()}catch(e){C(`${e}`),f(T.idle)}},error:p})||m===T.choosing&&Object(A.jsx)(J,{children:Object(A.jsx)(l.e,{children:"Choosing the device\u2026"})})||m===T.connecting&&Object(A.jsx)(J,{children:Object(A.jsx)(l.e,{children:"Connecting\u2026"})})||m===T.ready&&!w&&Object(A.jsx)(J,{children:Object(A.jsx)(l.e,{children:"Reading mug state\u2026"})})||m===T.ready&&w&&Object(A.jsxs)(A.Fragment,{children:[Object(A.jsx)(K,{temperature:r,name:e,battery:u,ledColor:b,liquidLevel:s,onNameChange:function(){if(null===e)return;const t=prompt("Set mug name",e);null!==t&&x.setMugName(t)}}),Object(A.jsx)(G,{temperature:i,onChange:function(e){x.setTargetTemperature(e)}}),Object(A.jsx)(R,{label:"LED color",children:Object(A.jsx)(z,{color:b,onChange:function(e){x.setLedColor(e)}})})]})})}function X(){return Object(A.jsxs)(l.c,{direction:"column",alignItems:"center",css:{gap:"1rem"},children:[Object(A.jsx)(j.a,{as:p.GrAlert,w:10,h:10}),Object(A.jsx)(l.d,{children:"Unsupported browser"}),Object(A.jsx)(l.e,{children:"Please use a browser with Bluetooth support, such as Chrome for Android."})]})}const Y=Object(m.b)({colors:{brand:{900:"hsl(14,82%,53%)",800:"hsl(14,82%,57%)",700:"hsl(14,82%,61%)"}}}),Z=({children:e,...t})=>Object(A.jsx)(l.b,{maxW:"min(96vw, 700px)",...t,children:e});var ee=function(){const e=!!navigator.bluetooth;return Object(A.jsx)(m.a,{theme:Y,children:Object(A.jsxs)(l.c,{minH:"100%",direction:"column",children:[Object(A.jsx)(l.a,{bgColor:"brand.900",textColor:"gray.50",py:4,children:Object(A.jsx)(Z,{children:Object(A.jsx)(l.d,{textAlign:"center",children:"mugctl"})})}),Object(A.jsx)(Z,{flex:1,display:"flex",flexDirection:"column",justifyContent:"space-around",children:e?Object(A.jsx)(Q,{}):Object(A.jsx)(X,{})})]})})};n.a.render(Object(A.jsx)(c.a.StrictMode,{children:Object(A.jsx)(ee,{})}),document.getElementById("root"))}},[[280,1,2]]]);
//# sourceMappingURL=main.5c098969.chunk.js.map